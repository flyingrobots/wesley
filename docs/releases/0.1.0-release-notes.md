# Wesley v0.1.0 — Release Notes (Draft)

Date: 2025-10-08

These notes summarize what’s shipping in v0.1.0 and what’s next. This draft is intended to become the GitHub Release text when tagging the version.

## Highlights

- Experimental QIR pipeline
  - SQL Lowering: SELECT/JOIN/LEFT JOIN LATERAL/ORDER BY/LIMIT/OFFSET with null/IN semantics and COALESCE(jsonb_agg).
  - Emission helpers: `emitView` and `emitFunction` (RETURNS SETOF jsonb).
  - Identifier safety: sanitized op names; reserved/63‑char checks; minimal quoting for unsafe identifiers.
- CLI — `--ops` (experimental) compiled operations
  - Strict discovery by default: recursively compiles `**/*.op.json`, deterministic order; fail‑loud when empty unless `--ops-allow-empty`.
  - Manifest mode: `--ops-manifest` with include/exclude/allowEmpty and `explainArgs` samples for EXPLAIN JSON.
  - Validation: Ajv schema checks of `*.op.json` against `schemas/op.schema.json`.
  - Artifacts: `out/ops/*.fn.sql` and (for paramless) `out/ops/*.view.sql`; aggregator `out/ops.functions.sql`.
  - Explain: `--ops-explain` (emit runnable EXPLAIN SQL files), `--ops-explain-json` + `--ops-dsn` (write JSON plans for paramless and for parameterized ops using manifest `explainArgs`).
- Tests
  - Generated pgTAP suites; ops smoke checks (existence + content assertions).
  - CLI Bats enabled locally and in CI; added manifest and collision tests.
- CI / Workflows
  - HOLMES pipeline hardened: noninteractive pgTAP install with `--no-install-recommends` and cleanup; apply ops via `psql -1`; strict seed and test steps.
  - Ubuntu-only matrices; architecture boundaries stabilized; docs link check and preflight.
- Docs
  - QIR Ops guide (`docs/guides/qir-ops.md`), JSON Schema validation and manifest examples.
  - Ops manifest cookbook with include/exclude patterns and `explainArgs` (`docs/cookbook/ops-manifest-examples.md`).

## Breaking Changes

- None. QIR and `--ops` remain experimental and behind explicit flags.

## Upgrade Notes

- Node 18/20/22 supported; pnpm 9 required. CI is Ubuntu‑only by design to control costs.
- If you used the earlier permissive discovery, expect strict fail‑loud behavior when no `*.op.json` are found; pass `--ops-allow-empty` if needed.
- If you run EXPLAIN JSON for parameterized ops, provide sample SQL expressions in your manifest `explainArgs` (quoted and cast as needed).

## Known Limitations

- GraphQL operation → QIR translation is not yet implemented; `--ops` compiles JSON operation descriptors today.
- ORDER BY tie‑breaker uses a heuristic on `<alias>.id`; will be replaced with PK/unique metadata.
- SQL functions return `SETOF jsonb`; a `RETURNS TABLE (...)` option is planned.

## What’s Next

- Minimal GraphQL op → QIR translator (MVP subset) and examples.
- DDL planner: backfill/switch/contract phases (explain‑only), per‑phase SQL emission.
- Optional RETURNS TABLE signatures.
- CI enrichment: optional EXPLAIN JSON analysis + gating in a dedicated workflow.

---

Thanks for trying Wesley. “Make it so, schema.”

